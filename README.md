# Hotel Booking QA System

This project is a Question-Answering (QA) and Analytics system built for the "Hotel Booking Demand" dataset from Kaggle. It integrates a Language Model (LLM) for natural language queries, provides analytical insights, and serves results via a FastAPI backend with a Streamlit frontend. The system supports both specific question answering (e.g., "How many customers booked a hotel in 2017?") and predefined analytics (e.g., revenue trends, cancellation rates).

## Features
- **QA System**: Answers user questions about hotel bookings using SQL queries generated by an LLM, with Retrieval-Augmented Generation (RAG) as a fallback.
- **Analytics**: Provides insights like revenue trends, cancellation rates, geographical distribution, and lead time distribution, each accompanied by a concise summary.
- **API**: FastAPI serves both QA and analytics endpoints.

## Prerequisites
- Python 3.10
- SQLite database (`bookings.db`) preprocessed from the Kaggle "Hotel Booking Demand" dataset
- FAISS index (`bookings_index.faiss`) for RAG
- Groq API key (for LLM)

## Setup Instructions

1. **Clone the Repository**
   ```bash
   git clone https://github.com/krishnakumar51/Hotel-booking-QA.git
   cd Hotel-booking-QA
   ```

2. **Install Dependencies**
   ```bash
   pip install -r requirements.txt
   ```
3. **Set Up Environment**
   - Create a `.env` file in the root directory:
     ```
     GROQ_API_KEY=your_groq_api_key_here
     ```
   - Ensure `bookings.db` and `bookings_index.faiss` are in `db/` and `models/`, respectively. (See [Data Preparation](#data-preparation) for details.)

4. **Run the API**
   ```bash
   cd src
   uvicorn api:app --reload
   ```

5. **Run the Streamlit Frontend**
   ```bash
   cd src
   streamlit run app.py
   ```
   - Access the app at `http://localhost:8501`.

## Usage

### QA System
- Select "Ask a Question" in the Streamlit sidebar.
- Enter a question (e.g., "How many customers booked a hotel in 2017?").
- Click "Ask" to see the response.

### Analytics
- Select "Analytics" in the sidebar.
- Choose an option (e.g., `revenue_trends`) and click "Get Analytics".
- View the table and summary.

## Sample Test Queries & Expected Answers

### QA Queries
1. **Query**: "How many customers booked a hotel in 2017?"
   - **Expected Answer**: "A total of 40,686 customers booked a hotel in 2017. This reflects a significant portion of the dataset’s bookings from 2015 to 2017."
   - **SQL**: `SELECT COUNT(*) FROM bookings WHERE strftime('%Y', arrival_date) = '2017';`

2. **Query**: "What is the total revenue from bookings in July 2017?"
   - **Expected Answer**: "The total revenue from bookings in July 2017 was approximately $4,500,000. This aligns with high summer demand."
   - **SQL**: `SELECT SUM(revenue) FROM bookings WHERE strftime('%Y-%m', arrival_date) = '2017-07';`

3. **Query**: "How many bookings were canceled in 2015?"
   - **Expected Answer**: "Around 9,000 bookings were canceled in 2015. This indicates a moderate cancellation rate for that year."
   - **SQL**: `SELECT COUNT(*) FROM bookings WHERE strftime('%Y', arrival_date) = '2015' AND is_canceled = 1;`

### Analytics Outputs
1. **Revenue Trends**
   - **Table**: List of `{"month": "YYYY-MM", "total_revenue": float}` (e.g., `[{"month": "2015-07", "total_revenue": 1234567.89}, ...]`).
   - **Summary**: "Revenue trends from July 2015 to August 2017 reveal a robust growth pattern, with monthly totals peaking in mid-2016..."

2. **Cancellation Rate**
   - **Table**: List of `{"month": "YYYY-MM", "cancel_rate": float}`.
   - **Summary**: "Cancellation rates hover between 30% and 40% over the period, peaking in August 2015..."

## Performance Evaluation

### Accuracy of Q&A Responses
- **Methodology**: Tested against a set of 10 diverse queries (counts, aggregates, filters). Compared LLM-generated SQL outputs with manual SQL results.
- **Results**: Achieved 100% accuracy for structured queries (e.g., "How many..." with clear year/country filters) after fixing SQL formatting issues. RAG fallback used for ambiguous queries (e.g., "Why do people cancel?") with ~80% relevance.
- **Validation**: Manual SQLite checks (e.g., `SELECT COUNT(*) FROM bookings WHERE strftime('%Y', arrival_date) = '2017';` yields 40,686).

### API Response Time & Optimization
- **Measurement**: Average response time measured using `curl` and Python `time` module:
  - QA: ~0.5–1 second (SQL path), ~1–2 seconds (RAG fallback).
  - Analytics: ~0.3–0.8 seconds.
- **Optimizations**:
  - LLM temperature set to 0 for consistent SQL generation.
  - FAISS index for fast RAG retrieval.
  - SQLite connection pooling could further reduce latency (future work).

## Implementation Choices & Challenges

### Choices
1. **LLM Integration**: Used Groq’s `llama-3.1-8b-instant` for fast, accurate SQL generation and natural language summaries. Chosen for speed and cost-effectiveness via API.
2. **SQL-First Approach**: Prioritized SQL for precise answers, with RAG as a fallback for unstructured queries, balancing accuracy and flexibility.
3. **FastAPI**: Lightweight, async-capable framework for efficient API serving.
4. **Streamlit**: Simple, interactive frontend for quick deployment and user testing.
5. **Structured Analytics Response**: Returned `{"table": ..., "summary": ...}` to enable clean UI separation in Streamlit.

### Challenges
1. **SQL Formatting**: Initial LLM outputs included Markdown (e.g., ```sql), causing SQLite errors. Fixed by adding a `clean_sql_query` function and refining the prompt.
2. **Response Consistency**: Early QA responses varied (e.g., 4 vs. 40,686 for 2017 bookings). Resolved by enforcing SQL path and fixing `answer_chain` definition.
3. **Analytics Display**: Streamlit’s `st.dataframe()` failed with string responses. Adjusted API to return structured JSON, enabling optimal table and summary rendering.
4. **Lead Time Distribution**: Non-tabular data required special handling in UI (list + stats) compared to other analytics.

## Data Preparation
- **Source**: Kaggle "Hotel Booking Demand" dataset.
- **Preprocessing**:
  - Merged `arrival_date_year`, `arrival_date_month`, `arrival_date_day_of_month` into `arrival_date` (YYYY-MM-DD).
  - Calculated `revenue` as `adr * total_nights`.
  - Stored in `bookings.db` with schema: `booking_id`, `arrival_date`, `country`, `adr`, `is_canceled`, `lead_time`, `revenue`.
- **FAISS Index**: Generated embeddings from booking descriptions using `sentence-transformers` (`all-MiniLM-L6-v2`).

## Deployment
- **Local**: Run API and Streamlit as described in [Setup Instructions](#setup-instructions).
- **Cloud (Optional)**: Deploy FastAPI on Heroku and Streamlit on Streamlit Community Cloud, linking to a hosted SQLite DB.
